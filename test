<div class="header_banner stores_banner">
    <div class="main_container">
        <h4 class="header_banner_heading">Center Map</h4>
    </div>
</div>
<div class="main_container mobile_padding">
    <div class="details_row">
        <div class="details_col_3">
            <p class='colored_link'>Find Store</p>
            <div id="stores_container">
                <script id="stores_template" type="x-tmpl-mustache/text">
                    <h5 class="stores_map"><a class="map_pin_a" href="#" data-value='{{x_coordinate}},{{y_coordinate}},{{id}}'>{{name}}</a></h5>
                </script>
            </div>
        </div>
        <div class="details_col_9">
            <div id="zoom_container">
                <img id="png_map" class="png_map" alt="center map" src="" />
                <div class="landmarks" data-show-at-zoom="100" data-allow-drag="true">
        	    </div>    
            </div>
        </div>
    </div>
</div>
<script src="//kodekloud.s3.amazonaws.com/sites/54d4e9206e6f64691f000000/d9e054e28dd1bad70a952dd85777e93f/jquery.smoothZoom.min.js"></script>
<script>
    $(document).ready(function(e){
        init(e);
        loadMallDataCached(renderPage);
    })
    
    function renderPage(){
         var stores = getStoresList();
        renderStoreList('#stores_container','#stores_template', stores, "stores", "A", "Z");
        renderStoreList('#landmark_container','#landmark_template', stores, "stores", "A", "Z");
        show_content();
        $('#top_nav_stores').addClass('active_yellow')
        
        $("#png_map").attr("src", getPNGMapURL())
		$('#png_map').smoothZoom({
		    height: 496,
		    width: 619,
		    initial_ZOOM: 0,
			zoom_MIN: 0,
			zoom_MAX: 100,
			responsive: true,
		    responsive_maintain_ratio: true,
			zoom_BUTTONS_SHOW : 'YES',
			pan_BUTTONS_SHOW : 'NO',
			pan_LIMIT_BOUNDARY : 'NO',
			button_ALIGN: "top right",
			container: 'zoom_container'
		});
		
		show_png_pin(".map_pin_a", "#png_map")
        
    }

function show_png_pin(trigger, map){
    $(trigger).click(function(e) {
        e.preventDefault()
        var isMobile = ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) );
        
        var zoomData = $(map).smoothZoom('getZoomData');
        x_coord = parseInt($(this).attr('store_x_coordinate'));
        y_coord = parseInt($(this).attr('store_y_coordinate'));
        
        name = $(this).text();
        $(map).smoothZoom('removeLandmark')
        if (isMobile) {
            $(map).smoothZoom('focusTo', {x:x_coord, y:y_coord, zoom:200});    
        } else {
            $(map).smoothZoom('focusTo', {x:x_coord, y:y_coord, zoom:300});
        }
        
        $(map).smoothZoom('addLandmark', 
			[
			'<div class="item mark" data-show-at-zoom="0" data-position="'+x_coord+','+y_coord+'">\
				<div>\
					<div class="text">\
					<strong>'+ name+ '</strong>\
				</div>\
				<img src="//codecloud.cdn.speedyrails.net/sites/54cfab316e6f6433ad020000/530d3a9b7bc13ce4a511089c23463f99/10dundas_pin.png" width="40px" height="59px" alt="marker" />\
				</div>\
			</div>'
			]
		);
    });
}
</script>